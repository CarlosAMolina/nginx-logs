if [ $# -eq 0 ]; then
  echo No arguments supplied
  exit 1
fi

process_name=$1
results_pathname="results/metrics-$1.txt"

echo Init process name $process_name and results file $results_pathname
echo Stop this script manually with Control + C

ps_columns=cpuid,%cpu,%mem
echo CPU_ID CPU% MEM% TIME > $results_pathname
while :
do
  result=$(ps --no-headers -p $(pgrep $process_name) -o $ps_columns 2> /dev/null)
  if [ -n "$result" ]; then
    result="$result $(date +"%T.%N")"
    echo $result >> $results_pathname
    #echo $result
  fi
done
